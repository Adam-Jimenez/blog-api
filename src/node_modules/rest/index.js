const express = require('express')
const app = express()
const cors = require('cors')
const bodyParser = require('body-parser')
const controllers = require('./controllers')
const middlewares = require('./middlewares')

app.use(cors())
app.use(bodyParser.json())

/* POSTS */

app.get('/posts',
    middlewares.pagination,
    controllers.posts.getPaginatedPosts
)

app.get('/posts/latest',
    controllers.posts.getLatestPost
)

app.get('/posts/:id',
    controllers.posts.getPostById
)

app.post('/posts',
    middlewares.authentification.adminAuthentification,
    middlewares.validation.validatePost,
    controllers.posts.createPost
)

app.put('/posts/:id',
    middlewares.authentification.adminAuthentification,
    middlewares.validation.validatePost,
    controllers.posts.editPost
)

/* PROJECTS */

app.get('/projects',
    middlewares.pagination,
    controllers.projects.getPaginatedProjects
)

app.get('/projects/:id',
    controllers.projects.getProjectById
)

app.post('/projects',
    middlewares.authentification.adminAuthentification,
    middlewares.validation.validatePost,
    controllers.projects.createProject
)

app.put('/projects/:id',
    middlewares.authentification.adminAuthentification,
    middlewares.validation.validatePost,
    controllers.projects.editProject
)

/* CONTACT */

app.post('/contact',
    controllers.contact.mailAdmin
)

/* COMMENTS */

app.get('/posts/:postId/comments',
    controllers.comments.getPostComments
)

app.post('/comments/:postId',
    middlewares.validation.validateComments,
    controllers.comments.createComment
)

module.exports = app
