const htmlparser = require('htmlparser2')
const _ = require('lodash')

module.exports = {
    sanitizeHtml: (parameterName) => {
        return (req, res, next) => {
            const html = req.body[parameterName]
            const allowedTags = [
                'p',
                'strong',
                'ol',
                'ul',
                'img',
                'pre',
                'br',
                'li',
                'em',
                'u'
            ]

            let htmlIsValid = true

            const parser = new htmlparser.Parser({
                onopentag: (name, attributes) => {
                    if (allowedTags.indexOf(name) === -1) {
                        console.log(name)
                        htmlIsValid = false
                    }
                }
            })
            parser.write(html)
            parser.end()
            if (htmlIsValid) {
                next()
            } else {
                res.status(400).send('Bad request')
            }
        }
    }
}
