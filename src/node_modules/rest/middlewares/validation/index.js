const htmlparser = require('htmlparser2')
const _ = require('lodash')
const validation = require('validation')

module.exports = {
    validatePost: (req, res, next) => {
        const html = req.body.content
        const allowedTags = [
            'p',
            'strong',
            'ol',
            'ul',
            'img',
            'pre',
            'br',
            'li',
            'em',
            'u',
            'a'
        ]

        const allowedAttributes = [
            'src', // for images
            'href', // for links
            'target' // for links
        ]

        const htmlIsValid = validation.validateHtml(html, allowedTags, allowedAttributes)
        if (htmlIsValid) {
            next()
        } else {
            res.status(400).send('Bad request')
        }
    },
    validateComments: (req, res, next) => {
        const html = req.body.content
        const htmlIsValid = validation.validateHtml(html)
        if (htmlIsValid) {
            next()
        } else {
            res.status(400).send('Bad request')
        }
    }
}
